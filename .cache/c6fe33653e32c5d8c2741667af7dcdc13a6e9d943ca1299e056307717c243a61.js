{"source":"(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{451:function(e,t,a){},452:function(e,t,a){},716:function(e,t,a){\"use strict\";var r=a(451);a.n(r).a},718:function(e,t,a){\"use strict\";var r=a(452);a.n(r).a},843:function(e,t,a){\"use strict\";a.r(t);var r={props:{CUStype:Array,cluesources:Array,area:Array,behavior:Array,fpunishment:Array,productType:Array,customerrating:Array},data:function(){return{exclude_customer_status:[],check_depart_id:\"\",departTree:[],selectDepart:\"\",allDepart:[],customerStatus:[],rating:[{id:1,typename:1,typecode:\"1\"},{id:2,typename:2,typecode:\"2\"},{id:3,typename:3,typecode:\"3\"},{id:4,typename:4,typecode:\"4\"},{id:5,typename:5,typecode:\"5\"}],customerTypes:[],open_create_rule:!1,formdata:{customerLevel:\"\",customerArea:\"\",channelTypeId:\"\",behavior:\"\",punishment:\"\",followRanks:\"\",changeTime:\"\",notifyTime:\"\",ruleMemo:\"\"},formdataRule:{customerLevel:{required:!0,message:\"客户等级必选！\",trigger:\"change\"},behavior:{required:!0,message:\"行为必选！\",trigger:\"change\"},followRanks:{required:!0,message:\"跟进评分必选！\",trigger:\"change\"},punishment:{required:!0,message:\"惩罚必选！\",trigger:\"change\"},changeTime:{required:!0,message:\"划入期限必填！\",trigger:\"blur\"},notifyTime:{required:!0,message:\"提前通知时间必填！\",trigger:\"blur\"}}}},methods:{handleReset:function(e){this.$refs[e].resetFields(),this.customerStatus=[],this.check_depart_id=\"\",this.exclude_customer_status=[],this.getAllDepartTree()},submit:function(){var t=this,a=this;this.$refs.formdata.validate(function(e){e?\"\"!=a.check_depart_id?a.create_rule():t.$Message.error(\"请选择部门！\"):t.$Message.error(\"请补全信息！\")})},create_rule:function(){var t=this,e=void 0;e=\"\"!=t.customerStatus?t.customerStatus[0]+\"-\"+t.customerStatus[1]:\"\";var a=void 0;a=\"\"!=t.exclude_customer_status?t.exclude_customer_status[0]+\"-\"+t.exclude_customer_status[1]:\"\";var r={customerStatus:e,customerLevel:t.formdata.customerLevel,followRanks:t.formdata.followRanks,punishment:t.formdata.punishment,changeTime:t.formdata.changeTime,notifyTime:t.formdata.notifyTime,departId:t.check_depart_id,ruleMemo:t.formdata.ruleMemo,customerArea:t.formdata.customerArea,channelTypeId:t.formdata.channelTypeId,behavior:t.formdata.behavior,excludeCustomerStatus:a};this.$Post(\"api/crm/sale/rule/create\",r,function(e){t.open_create_rule=!1,t.$bus.emit(\"update_customer_rule\",!0),t.formdata.customerLevel=\"\",t.formdata.followRanks=\"\",t.formdata.followRanks=\"\",t.formdata.changeTime=\"\",t.formdata.notifyTime=\"\",t.formdata.ruleMemo=\"\",t.formdata.departId=\"\",t.formdata.customerArea=\"\",t.formdata.channelTypeId=\"\",t.formdata.behavior=\"\",t.customerStatus=[]},function(e){})},getAllDepart:function(){var t=this;this.$Get(\"api/system/depart/list\",{},function(e){t.allDepart=e.data.data})},getAllDepartTree:function(){var o=this;this.$Get(\"api/system/depart/tree/list\",{},function(e){o.departTree=e.data.data;for(var t=0;t<o.departTree.length;t++)if(o.departTree[t].title=o.departTree[t].departname,o.departTree[t].level=1,o.departTree[t].children)for(var a=0;a<o.departTree[t].children.length;a++)if(o.departTree[t].children[a].title=o.departTree[t].children[a].departname,o.departTree[t].children[a].level=2,o.departTree[t].children[a].children)for(var r=0;r<o.departTree[t].children[a].children.length;r++)if(o.departTree[t].children[a].children[r].title=o.departTree[t].children[a].children[r].departname,o.departTree[t].children[a].children[r].level=3,o.departTree[t].children[a].children[r].children)for(var s=0;s<o.departTree[t].children[a].children[r].children.length;s++)o.departTree[t].children[a].children[r].children[s].title=o.departTree[t].children[a].children[r].children[s].departname,o.departTree[t].children[a].children[r].children[s].level=4})},getCheckedNodes:function(e){var t=[];if(0==e.length)t=[];else{t.push(e[0].ID);for(var a=1;a<e.length;a++)e[0].level==e[a].level&&t.push(e[a].ID)}this.check_depart_id=t.join(\",\")}},created:function(){var t=this;this.getAllDepartTree(),this.$bus.on(\"open_create_customer_rule\",function(e){t.open_create_rule=!0})}},s=(a(716),a(4)),o=Object(s.a)(r,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a(\"Modal\",{attrs:{title:\"新增销售规则\",width:\"900\",\"mask-closable\":!1},on:{\"on-cancel\":function(e){t.handleReset(\"formdata\")}},model:{value:t.open_create_rule,callback:function(e){t.open_create_rule=e},expression:\"open_create_rule\"}},[a(\"Row\",{attrs:{gutter:20}},[a(\"Col\",{attrs:{span:\"15\"}},[a(\"Form\",{ref:\"formdata\",attrs:{\"label-width\":100,rules:t.formdataRule,model:t.formdata,\"show-message\":!1}},[a(\"Row\",[a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{prop:\"customerStatus\"}},[a(\"span\",{staticClass:\"warning\",attrs:{slot:\"label\"},slot:\"label\"},[t._v(\"客户状态\")]),t._v(\" \"),a(\"Cascader\",{staticStyle:{width:\"100%\"},attrs:{size:\"small\",data:t.CUStype,trigger:\"hover\",transfer:\"\"},model:{value:t.customerStatus,callback:function(e){t.customerStatus=e},expression:\"customerStatus\"}})],1)],1),t._v(\" \"),a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{label:\"客户等级\",prop:\"customerLevel\"}},[a(\"Select\",{staticStyle:{width:\"100%\"},attrs:{transfer:\"\",size:\"small\"},model:{value:t.formdata.customerLevel,callback:function(e){t.$set(t.formdata,\"customerLevel\",e)},expression:\"formdata.customerLevel\"}},t._l(t.customerrating,function(e){return a(\"Option\",{key:e.id,attrs:{value:e.typecode}},[t._v(t._s(e.typename))])}),1)],1)],1)],1),t._v(\" \"),a(\"Row\",[a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{label:\"客户地区\",prop:\"customerArea\"}},[a(\"Select\",{staticStyle:{width:\"100%\"},attrs:{transfer:\"\",size:\"small\"},model:{value:t.formdata.customerArea,callback:function(e){t.$set(t.formdata,\"customerArea\",e)},expression:\"formdata.customerArea\"}},t._l(t.area,function(e){return a(\"Option\",{key:e.id,attrs:{value:e.typecode}},[t._v(t._s(e.typename))])}),1)],1)],1),t._v(\" \"),a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{label:\"客户渠道\",prop:\"channelTypeId\"}},[a(\"Select\",{staticStyle:{width:\"100%\"},attrs:{transfer:\"\",size:\"small\"},model:{value:t.formdata.channelTypeId,callback:function(e){t.$set(t.formdata,\"channelTypeId\",e)},expression:\"formdata.channelTypeId\"}},t._l(t.cluesources,function(e){return a(\"Option\",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.channel_type_name))])}),1)],1)],1)],1),t._v(\" \"),a(\"Row\",[a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{label:\"行为\",prop:\"behavior\"}},[a(\"Select\",{staticStyle:{width:\"100%\"},attrs:{transfer:\"\",size:\"small\"},model:{value:t.formdata.behavior,callback:function(e){t.$set(t.formdata,\"behavior\",e)},expression:\"formdata.behavior\"}},t._l(t.behavior,function(e){return a(\"Option\",{key:e.id,attrs:{value:e.typecode}},[t._v(t._s(e.typename))])}),1)],1)],1),t._v(\" \"),a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{label:\"惩罚\",prop:\"punishment\"}},[a(\"Select\",{staticStyle:{width:\"100%\"},attrs:{transfer:\"\",size:\"small\"},model:{value:t.formdata.punishment,callback:function(e){t.$set(t.formdata,\"punishment\",e)},expression:\"formdata.punishment\"}},t._l(t.fpunishment,function(e){return a(\"Option\",{key:e.id,attrs:{value:e.typecode}},[t._v(t._s(e.typename))])}),1)],1)],1)],1),t._v(\" \"),a(\"Row\",[a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{label:\"跟进评分\",prop:\"followRanks\"}},[a(\"Select\",{staticStyle:{width:\"100%\"},attrs:{transfer:\"\",size:\"small\"},model:{value:t.formdata.followRanks,callback:function(e){t.$set(t.formdata,\"followRanks\",e)},expression:\"formdata.followRanks\"}},t._l(t.rating,function(e){return a(\"Option\",{key:e.id,attrs:{value:e.typecode}},[t._v(t._s(e.typename))])}),1)],1)],1)],1),t._v(\" \"),a(\"Row\",[a(\"Col\",[a(\"FormItem\",{attrs:{label:\"划入期限\",prop:\"changeTime\"}},[a(\"Input\",{staticStyle:{width:\"80px\",\"margin-right\":\"5px\"},attrs:{size:\"small\"},model:{value:t.formdata.changeTime,callback:function(e){t.$set(t.formdata,\"changeTime\",e)},expression:\"formdata.changeTime\"}}),t._v(\" \"),a(\"span\",[t._v(\"天（有效天数，非工作日）\")])],1)],1)],1),t._v(\" \"),a(\"Row\",[a(\"Col\",[a(\"FormItem\",{attrs:{label:\"提前通知时间\",prop:\"notifyTime\"}},[a(\"Input\",{staticStyle:{width:\"80px\",\"margin-right\":\"5px\"},attrs:{size:\"small\"},model:{value:t.formdata.notifyTime,callback:function(e){t.$set(t.formdata,\"notifyTime\",e)},expression:\"formdata.notifyTime\"}}),t._v(\" \"),a(\"span\",[t._v(\"天（有效天数，非工作日）\")])],1)],1),t._v(\" \"),a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{prop:\"exclude_customer_status\"}},[a(\"span\",{staticClass:\"warning\",attrs:{slot:\"label\"},slot:\"label\"},[t._v(\"排除客户状态\")]),t._v(\" \"),a(\"Cascader\",{staticStyle:{width:\"100%\"},attrs:{size:\"small\",data:t.CUStype,trigger:\"hover\",transfer:\"\"},model:{value:t.exclude_customer_status,callback:function(e){t.exclude_customer_status=e},expression:\"exclude_customer_status\"}})],1)],1)],1)],1)],1),t._v(\" \"),a(\"Col\",{attrs:{span:\"9\"}},[a(\"Row\",{attrs:{gutter:5}},[a(\"div\",{staticStyle:{\"padding-bottom\":\"5px\"}},[t._v(\"说明：\")]),t._v(\" \"),a(\"Input\",{attrs:{type:\"textarea\",rows:6},model:{value:t.formdata.ruleMemo,callback:function(e){t.$set(t.formdata,\"ruleMemo\",e)},expression:\"formdata.ruleMemo\"}})],1),t._v(\" \"),a(\"Row\",{attrs:{gutter:5}},[a(\"div\",{staticClass:\"warning\",staticStyle:{\"padding-bottom\":\"1px\",\"padding-top\":\"5px\"}},[t._v(\"部门：\")]),t._v(\" \"),a(\"Tree\",{attrs:{data:t.departTree,\"show-checkbox\":\"\"},on:{\"on-check-change\":t.getCheckedNodes}})],1)],1)],1),t._v(\" \"),a(\"div\",{attrs:{slot:\"footer\"},slot:\"footer\"},[a(\"Button\",{staticStyle:{\"margin-bottom\":\"10px\"},attrs:{type:\"primary\"},on:{click:t.submit}},[t._v(\"新增\")])],1)],1)},[],!1,null,\"e70f1afc\",null);o.options.__file=\"create_rule.vue\";var n=o.exports,i={props:{CUStype:Array,cluesources:Array,area:Array,behavior:Array,fpunishment:Array,productType:Array,customerrating:Array},data:function(){return{check_depart_id:\"\",departTree:[],selectDepart:\"\",allDepart:[],customerStatus:[],exclude_customer_status:[],rating:[{id:1,typename:1,typecode:\"1\"},{id:2,typename:2,typecode:\"2\"},{id:3,typename:3,typecode:\"3\"},{id:4,typename:4,typecode:\"4\"},{id:5,typename:5,typecode:\"5\"}],customerTypes:[],edit_create_rule:!1,formdata:{id:\"\",customerLevel:\"\",customerArea:\"\",channelTypeId:\"\",behavior:\"\",punishment:\"\",followRanks:\"\",changeTime:\"\",notifyTime:\"\",ruleMemo:\"\"},formdataRule:{customerLevel:{required:!0,message:\"客户等级必选！\",trigger:\"change\"},behavior:{required:!0,message:\"行为必选！\",trigger:\"change\"},followRanks:{required:!0,message:\"跟进评分必选！\",trigger:\"change\"},punishment:{required:!0,message:\"惩罚必选！\",trigger:\"change\"},changeTime:{required:!0,message:\"划入期限必填！\",trigger:\"blur\"},notifyTime:{required:!0,message:\"提前通知时间必填！\",trigger:\"blur\"}}}},methods:{handleReset:function(e){this.$refs[e].resetFields(),this.customerStatus=[],this.check_depart_id=\"\",this.getAllDepartTree()},submit:function(){var t=this,a=this;this.$refs.formdata.validate(function(e){e&&\"\"!=a.check_depart_id?a.create_rule():t.$Message.error(\"请补全信息！\")})},create_rule:function(){var t=this,e=\"\";e=\"\"!=t.customerStatus?t.customerStatus[0]+\"-\"+t.customerStatus[1]:\"\";var a=\"\";a=\"\"!=t.exclude_customer_status?t.exclude_customer_status[0]+\"-\"+t.exclude_customer_status[1]:\"\";var r={id:t.formdata.id,customerStatus:e,customerLevel:t.formdata.customerLevel,followRanks:t.formdata.followRanks,punishment:t.formdata.punishment,changeTime:t.formdata.changeTime,notifyTime:t.formdata.notifyTime,departId:t.check_depart_id,ruleMemo:t.formdata.ruleMemo,customerArea:t.formdata.customerArea,channelTypeId:t.formdata.channelTypeId,behavior:t.formdata.behavior,excludeCustomerStatus:a};this.$Post(\"api/crm/sale/rule/update\",r,function(e){t.open_create_rule=!1,t.$bus.emit(\"update_customer_rule\",!0),t.formdata.customerLevel=\"\",t.formdata.followRanks=\"\",t.formdata.changeTime=\"\",t.formdata.notifyTime=\"\",t.formdata.ruleMemo=\"\",t.check_depart_id=\"\",t.formdata.customerArea=\"\",t.formdata.channelTypeId=\"\",t.formdata.behavior=\"\",t.customerStatus=[],t.exclude_customer_status=[],t.edit_create_rule=!1},function(e){})},getAllDepart:function(){var t=this;this.$Get(\"api/system/depart/list\",{},function(e){t.allDepart=e.data.data})},getAllDepartTree:function(){var o=this;this.$Get(\"api/system/depart/tree/list\",{},function(e){o.departTree=e.data.data;for(var t=0;t<o.departTree.length;t++)if(o.departTree[t].title=o.departTree[t].departname,o.departTree[t].ID==o.check_depart_id&&(o.departTree[t].checked=!0),o.departTree[t].children)for(var a=0;a<o.departTree[t].children.length;a++)if(o.departTree[t].children[a].ID==o.check_depart_id&&(o.departTree[t].children[a].checked=!0),o.departTree[t].children[a].title=o.departTree[t].children[a].departname,o.departTree[t].children[a].children)for(var r=0;r<o.departTree[t].children[a].children.length;r++)if(o.departTree[t].children[a].children[r].ID==o.check_depart_id&&(o.departTree[t].children[a].children[r].checked=!0),o.departTree[t].children[a].children[r].title=o.departTree[t].children[a].children[r].departname,o.departTree[t].children[a].children[r].children)for(var s=0;s<o.departTree[t].children[a].children[r].children.length;s++)o.departTree[t].children[a].children[r].children[s].ID&&(o.departTree[t].children[a].children[r].children[s].checked=!0),o.departTree[t].children[a].children[r].children[s].title=o.departTree[t].children[a].children[r].children[s].departname})},getCheckedNodes:function(e){0==e.length?this.check_depart_id=\"\":this.check_depart_id=e[0].ID}},created:function(){var o=this,n=this;this.$bus.on(\"open_edit_customer_rule\",function(e){if(n.formdata.customerLevel=e.customer_level.toString(),n.formdata.customerArea=e.customer_area,e.follow_ranks&&(n.formdata.followRanks=e.follow_ranks.toString()),e.change_time&&(n.formdata.changeTime=e.change_time.toString()),e.notify_time&&(n.formdata.notifyTime=e.notify_time.toString()),n.check_depart_id=e.depart_id,n.formdata.id=e.id,n.formdata.channelTypeId=e.channel_type_id,n.formdata.behavior=e.behavior,n.formdata.punishment=e.punishment,n.formdata.ruleMemo=e.rule_memo,e.customer_status){var t=parseInt(e.customer_status.split(\"-\")[0]),a=parseInt(e.customer_status.split(\"-\")[1]);n.customerStatus.push(t),n.customerStatus.push(a)}if(e.exclude_customer_status){var r=parseInt(e.exclude_customer_status.split(\"-\")[0]),s=parseInt(e.exclude_customer_status.split(\"-\")[1]);n.exclude_customer_status.push(r),n.exclude_customer_status.push(s)}n.edit_create_rule=!0,o.getAllDepartTree()})}},l=(a(718),Object(s.a)(i,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a(\"Modal\",{attrs:{title:\"修改销售规则\",width:\"900\",\"mask-closable\":!1},on:{\"on-cancel\":function(e){t.handleReset(\"formdata\")}},model:{value:t.edit_create_rule,callback:function(e){t.edit_create_rule=e},expression:\"edit_create_rule\"}},[a(\"Row\",{attrs:{gutter:20}},[a(\"Col\",{attrs:{span:\"15\"}},[a(\"Form\",{ref:\"formdata\",attrs:{\"label-width\":100,rules:t.formdataRule,model:t.formdata,\"show-message\":!1}},[a(\"Row\",[a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{prop:\"customerStatus\"}},[a(\"span\",{staticClass:\"warning\",attrs:{slot:\"label\"},slot:\"label\"},[t._v(\"客户状态\")]),t._v(\" \"),a(\"Cascader\",{staticStyle:{width:\"100%\"},attrs:{size:\"small\",data:t.CUStype,trigger:\"hover\",transfer:\"\"},model:{value:t.customerStatus,callback:function(e){t.customerStatus=e},expression:\"customerStatus\"}})],1)],1),t._v(\" \"),a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{label:\"客户等级\",prop:\"customerLevel\"}},[a(\"Select\",{staticStyle:{width:\"100%\"},attrs:{transfer:\"\",size:\"small\"},model:{value:t.formdata.customerLevel,callback:function(e){t.$set(t.formdata,\"customerLevel\",e)},expression:\"formdata.customerLevel\"}},t._l(t.customerrating,function(e){return a(\"Option\",{key:e.id,attrs:{value:e.typecode}},[t._v(t._s(e.typename))])}),1)],1)],1)],1),t._v(\" \"),a(\"Row\",[a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{label:\"客户地区\",prop:\"customerArea\"}},[a(\"Select\",{staticStyle:{width:\"100%\"},attrs:{transfer:\"\",size:\"small\"},model:{value:t.formdata.customerArea,callback:function(e){t.$set(t.formdata,\"customerArea\",e)},expression:\"formdata.customerArea\"}},t._l(t.area,function(e){return a(\"Option\",{key:e.id,attrs:{value:e.typecode}},[t._v(t._s(e.typename))])}),1)],1)],1),t._v(\" \"),a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{label:\"客户渠道\",prop:\"channelTypeId\"}},[a(\"Select\",{staticStyle:{width:\"100%\"},attrs:{transfer:\"\",size:\"small\"},model:{value:t.formdata.channelTypeId,callback:function(e){t.$set(t.formdata,\"channelTypeId\",e)},expression:\"formdata.channelTypeId\"}},t._l(t.cluesources,function(e){return a(\"Option\",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.channel_type_name))])}),1)],1)],1)],1),t._v(\" \"),a(\"Row\",[a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{label:\"行为\",prop:\"behavior\"}},[a(\"Select\",{staticStyle:{width:\"100%\"},attrs:{transfer:\"\",size:\"small\"},model:{value:t.formdata.behavior,callback:function(e){t.$set(t.formdata,\"behavior\",e)},expression:\"formdata.behavior\"}},t._l(t.behavior,function(e){return a(\"Option\",{key:e.id,attrs:{value:e.typecode}},[t._v(t._s(e.typename))])}),1)],1)],1),t._v(\" \"),a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{label:\"惩罚\",prop:\"punishment\"}},[a(\"Select\",{staticStyle:{width:\"100%\"},attrs:{transfer:\"\",size:\"small\"},model:{value:t.formdata.punishment,callback:function(e){t.$set(t.formdata,\"punishment\",e)},expression:\"formdata.punishment\"}},t._l(t.fpunishment,function(e){return a(\"Option\",{key:e.id,attrs:{value:e.typecode}},[t._v(t._s(e.typename))])}),1)],1)],1)],1),t._v(\" \"),a(\"Row\",[a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{label:\"跟进评分\",prop:\"followRanks\"}},[a(\"Select\",{staticStyle:{width:\"100%\"},attrs:{transfer:\"\",size:\"small\"},model:{value:t.formdata.followRanks,callback:function(e){t.$set(t.formdata,\"followRanks\",e)},expression:\"formdata.followRanks\"}},t._l(t.rating,function(e){return a(\"Option\",{key:e.id,attrs:{value:e.typecode}},[t._v(t._s(e.typename))])}),1)],1)],1)],1),t._v(\" \"),a(\"Row\",[a(\"Col\",[a(\"FormItem\",{attrs:{label:\"划入期限\",prop:\"changeTime\"}},[a(\"Input\",{staticStyle:{width:\"80px\",\"margin-right\":\"5px\"},attrs:{size:\"small\"},model:{value:t.formdata.changeTime,callback:function(e){t.$set(t.formdata,\"changeTime\",e)},expression:\"formdata.changeTime\"}}),t._v(\" \"),a(\"span\",[t._v(\"天（有效天数，非工作日）\")])],1)],1)],1),t._v(\" \"),a(\"Row\",[a(\"Col\",[a(\"FormItem\",{attrs:{label:\"提前通知时间\",prop:\"notifyTime\"}},[a(\"Input\",{staticStyle:{width:\"80px\",\"margin-right\":\"5px\"},attrs:{size:\"small\"},model:{value:t.formdata.notifyTime,callback:function(e){t.$set(t.formdata,\"notifyTime\",e)},expression:\"formdata.notifyTime\"}}),t._v(\" \"),a(\"span\",[t._v(\"天（有效天数，非工作日）\")])],1)],1),t._v(\" \"),a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{prop:\"exclude_customer_status\"}},[a(\"span\",{staticClass:\"warning\",attrs:{slot:\"label\"},slot:\"label\"},[t._v(\"排除客户状态\")]),t._v(\" \"),a(\"Cascader\",{staticStyle:{width:\"100%\"},attrs:{size:\"small\",data:t.CUStype,trigger:\"hover\",transfer:\"\"},model:{value:t.exclude_customer_status,callback:function(e){t.exclude_customer_status=e},expression:\"exclude_customer_status\"}})],1)],1)],1)],1)],1),t._v(\" \"),a(\"Col\",{attrs:{span:\"9\"}},[a(\"Row\",{attrs:{gutter:5}},[a(\"div\",{staticStyle:{\"padding-bottom\":\"5px\"}},[t._v(\"说明：\")]),t._v(\" \"),a(\"Input\",{attrs:{type:\"textarea\",rows:6},model:{value:t.formdata.ruleMemo,callback:function(e){t.$set(t.formdata,\"ruleMemo\",e)},expression:\"formdata.ruleMemo\"}})],1),t._v(\" \"),a(\"Row\",{attrs:{gutter:5}},[a(\"div\",{staticClass:\"warning\",staticStyle:{\"padding-bottom\":\"1px\",\"padding-top\":\"5px\"}},[t._v(\"部门：\")]),t._v(\" \"),a(\"Tree\",{attrs:{data:t.departTree,\"show-checkbox\":\"\"},on:{\"on-check-change\":t.getCheckedNodes}})],1)],1)],1),t._v(\" \"),a(\"div\",{attrs:{slot:\"footer\"},slot:\"footer\"},[a(\"Button\",{staticStyle:{\"margin-bottom\":\"10px\"},attrs:{type:\"primary\"},on:{click:t.submit}},[t._v(\"修改\")])],1)],1)},[],!1,null,\"680d7d1a\",null));l.options.__file=\"update_rule.vue\";var c={name:\"market_rule_index\",components:{createRule:n,updateRule:l.exports},data:function(){var a=this;return{columns:[{title:\"部门\",key:\"departname\",width:120},{title:\"客户状态\",key:\"customer_status_name\",width:150},{title:\"排除客户状态\",key:\"exculde_customer_status_name\",width:150},{title:\"客户级别\",key:\"customer_level_name\",width:120},{title:\"客户区域\",key:\"customer_area_name\",width:120},{title:\"客户渠道\",key:\"channel_type_name\",width:120},{title:\"行为\",key:\"behavior_name\",width:120},{title:\"跟进评分\",key:\"follow_ranks\",width:120},{title:\"通知期限\",key:\"notify_time\",width:120},{title:\"更改期限\",key:\"change_time\",width:120},{title:\"惩罚\",key:\"punishment_name\",width:120},{title:\"规则备注\",key:\"rule_memo\",width:180,render:function(e,t){return t.row.rule_memo.length<10?e(\"div\",t.row.rule_memo):e(\"Poptip\",{props:{trigger:\"hover\",title:\"详情\",placement:\"bottom\"}},[e(\"span\",t.row.rule_memo.slice(0,10)+\"...\"),e(\"div\",{slot:\"content\"},[e(\"span\",t.row.rule_memo)])])}},{title:\"规则状态\",key:\"taskstate\",width:120},{title:\"操作\",key:\"action\",fixed:\"right\",width:200,align:\"center\",render:function(e,t){return\"PAUSED\"==t.row.taskstate||null==t.row.taskstate?e(\"div\",[e(\"Button\",{props:{type:\"text\",size:\"small\"},on:{click:function(){a.$bus.emit(\"open_edit_customer_rule\",t.row)}}},\"[修改]\"),e(\"Button\",{props:{type:\"text\",size:\"small\"},on:{click:function(){a.start(t.row.task_id)}}},\"[执行]\")]):e(\"div\",[e(\"Button\",{props:{type:\"text\",size:\"small\"},on:{click:function(){a.$bus.emit(\"open_edit_customer_rule\",t.row)}}},\"[修改]\"),e(\"Button\",{props:{type:\"text\",size:\"small\"},on:{click:function(){a.stop(t.row.task_id)}}},\"[停止]\")])}}],data:[],rule_loading:!1,pageTotal:new Number,page:1,customerTypes:[],customerrating:[],cluesources:[],area:[],behavior:[],fpunishment:[],productType:[],customerrating_Map:new Map,cluesources_Map:new Map,area_Map:new Map,fpunishment_Map:new Map,behavior_Map:new Map,productType_Map:new Map,customerTypes_Array:[]}},methods:{start:function(e){var t=this,a={jobId:e};this.$Post(\"api/system/task/job/begin\",a,function(e){t.getData()},function(e){})},stop:function(e){var t=this,a={jobId:e};this.$Post(\"api/system/task/job/pause\",a,function(e){t.getData()},function(e){})},getData:function(){var a=this;a.rule_loading=!0;var e={params:{page:a.page,pageSize:10}};this.$Get(\"api/crm/sale/rule/list\",e,function(e){a.pageTotal=e.data.data.total,a.data=e.data.data.rows,a.rule_loading=!1;for(var t=0;t<a.data.length;t++)a.data[t].customer_area_name=a.area_Map.get(a.data[t].customer_area),a.data[t].behavior_name=a.behavior_Map.get(a.data[t].behavior),\"\"!=a.data[t].customer_status&&(a.data[t].customer_status_name=a.getLocalType(a.data[t].customer_status)),a.data[t].exclude_customer_status&&(a.data[t].exculde_customer_status_name=a.getLocalType(a.data[t].exclude_customer_status)),null!=a.data[t].customer_level&&(a.data[t].customer_level_name=a.customerrating_Map.get(a.data[t].customer_level.toString())),a.data[t].behavior_name=a.behavior_Map.get(a.data[t].behavior),a.data[t].punishment_name=a.fpunishment_Map.get(a.data[t].punishment)})},pageChange:function(e){this.page=e,this.getData()},getCustomerType:function(){var t=this;this.$GetDataCenter(\"customerTypes\",function(e){t.customerTypes=t.$changeCars(e.data.data.customerTypes),t.customerTypes_Array=t.$Data2Casr(e.data.data.customerTypes),t.customerTypes.push({label:\"空\"})})},getLocalType:function(e){for(var t=this,a=e.split(\"-\")[0],r=e.split(\"-\")[1],s=0;s<t.customerTypes_Array.length;s++)if(r==t.customerTypes_Array[s].id)return t.customerTypes_Array[s].ptypename+\" - \"+t.customerTypes_Array[s].typename;if(\"\"==r)for(var o=0;o<t.customerTypes_Array.length;o++)if(a==t.customerTypes_Array[o].pid)return t.customerTypes_Array[o].ptypename+\"- 无\"},getDataCenter:function(){var t=this;this.$GetDataCenter(\"customerrating,cluesources,area,behavior,fpunishment,productType\",function(e){t.customerrating=e.data.data.customerrating,t.area=e.data.data.area,t.area.push({typename:\"空\"}),t.behavior=e.data.data.behavior,t.fpunishment=e.data.data.fpunishment,t.productType=e.data.data.productType,t.customerrating_Map=t.$array2map(t.customerrating),t.area_Map=t.$array2map(t.area),t.behavior_Map=t.$array2map(t.behavior),t.fpunishment_Map=t.$array2map(t.fpunishment),t.productType_Map=t.$array2map(t.productType)})},getChannelList:function(){var t=this;this.$Get(\"api/channel/type/list\",{params:{page:1,pageSize:1e3}},function(e){t.cluesources=e.data.data.rows,t.cluesources.push({channel_type_name:\"空\"})})},open_create_pool_rule:function(){this.$bus.emit(\"open_create_customer_rule\",!0)}},created:function(){this.getChannelList(),this.getDataCenter(),this.getCustomerType(),this.getData();var t=this;this.$bus.on(\"update_customer_rule\",function(e){t.getData()})}},u=Object(s.a)(c,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a(\"div\",[a(\"Card\",[a(\"div\",{attrs:{slot:\"title\"},slot:\"title\"},[t._v(\"规则说明\")]),t._v(\" \"),a(\"div\",[a(\"Row\",[t._v(\"\\n                1、如果启用了【超过N天“未成交”的客户，由系统定时划入公海】，即便在N天内跟进了，只要客户的客户状态不是“成交客户”，仍然会被划入公海。\\n            \")]),t._v(\" \"),a(\"Row\",[t._v(\"2、超级管理员负责的客户，不会自动划入客户公海。\")]),t._v(\" \"),a(\"Row\",[t._v(\"3、渠道客户的惩罚默认为由有效成交线索转成有效线索\")]),t._v(\" \"),a(\"Row\",[t._v(\"4、市场部客户的惩罚默认为转入公海池\")]),t._v(\" \"),a(\"Row\",[t._v(\"5、划入期限为0时，惩罚实时生效；划入时间为N时，惩罚不生效\")]),t._v(\" \"),a(\"Row\",[t._v(\"6、客户状态、客户等级。行为、跟进评分不能都选择“全部”或者“无”\")])],1)]),t._v(\" \"),a(\"Card\",[a(\"ButtonGroup\",[a(\"Button\",{staticStyle:{\"margin-bottom\":\"10px\"},attrs:{type:\"primary\"},on:{click:t.open_create_pool_rule}},[t._v(\"新增规则\")])],1),t._v(\" \"),a(\"Table\",{attrs:{\"highlight-row\":\"\",size:\"small\",columns:t.columns,data:t.data,loading:t.rule_loading}}),t._v(\" \"),a(\"Page\",{staticStyle:{\"margin-top\":\"10px\"},attrs:{size:\"small\",total:t.pageTotal,current:t.page,\"show-total\":\"\",\"show-elevator\":\"\"},on:{\"update:current\":function(e){t.page=e},\"on-change\":t.pageChange}})],1),t._v(\" \"),a(\"create-rule\",{attrs:{CUStype:t.customerTypes,cluesources:t.cluesources,area:t.area,behavior:t.behavior,fpunishment:t.fpunishment,productType:t.productType,customerrating:t.customerrating}}),t._v(\" \"),a(\"update-rule\",{attrs:{CUStype:t.customerTypes,cluesources:t.cluesources,area:t.area,behavior:t.behavior,fpunishment:t.fpunishment,productType:t.productType,customerrating:t.customerrating}})],1)},[],!1,null,null,null);u.options.__file=\"index.vue\";t.default=u.exports}}]);"}