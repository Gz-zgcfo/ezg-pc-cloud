{"source":"(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{138:function(e,t,a){},139:function(e,t,a){},292:function(e,t,a){\"use strict\";var r=a(138);a.n(r).a},294:function(e,t,a){\"use strict\";var r=a(139);a.n(r).a},429:function(e,t,a){\"use strict\";a.r(t);var r={props:{CUStype:Array,cluesources:Array,area:Array,behavior:Array,fpunishment:Array,productType:Array,customerrating:Array},data:function(){return{exclude_customer_status:[],check_depart_id:\"\",departTree:[],selectDepart:\"\",allDepart:[],customerStatus:[],rating:[{id:1,typename:1,typecode:\"1\"},{id:2,typename:2,typecode:\"2\"},{id:3,typename:3,typecode:\"3\"},{id:4,typename:4,typecode:\"4\"},{id:5,typename:5,typecode:\"5\"}],customerTypes:[],open_create_rule:!1,formdata:{customerLevel:\"\",customerArea:\"\",channelTypeId:\"\",behavior:\"\",punishment:\"\",followRanks:\"\",changeTime:\"\",notifyTime:\"\",ruleMemo:\"\"},formdataRule:{customerLevel:{required:!0,message:\"客户等级必选！\",trigger:\"change\"},behavior:{required:!0,message:\"行为必选！\",trigger:\"change\"},followRanks:{required:!0,message:\"跟进评分必选！\",trigger:\"change\"},punishment:{required:!0,message:\"惩罚必选！\",trigger:\"change\"},changeTime:{required:!0,message:\"划入期限必填！\",trigger:\"blur\"},notifyTime:{required:!0,message:\"提前通知时间必填！\",trigger:\"blur\"}}}},methods:{handleReset:function(e){this.$refs[e].resetFields(),this.customerStatus=[],this.check_depart_id=\"\",this.exclude_customer_status=[],this.getAllDepartTree()},submit:function(){var e=this,t=this;this.$refs.formdata.validate(function(a){a?\"\"!=t.check_depart_id?t.create_rule():e.$Message.error(\"请选择部门！\"):e.$Message.error(\"请补全信息！\")})},create_rule:function(){var e,t,a=this;e=\"\"!=a.customerStatus?a.customerStatus[0]+\"-\"+a.customerStatus[1]:\"\",t=\"\"!=a.exclude_customer_status?a.exclude_customer_status[0]+\"-\"+a.exclude_customer_status[1]:\"\";var r={customerStatus:e,customerLevel:a.formdata.customerLevel,followRanks:a.formdata.followRanks,punishment:a.formdata.punishment,changeTime:a.formdata.changeTime,notifyTime:a.formdata.notifyTime,departId:a.check_depart_id,ruleMemo:a.formdata.ruleMemo,customerArea:a.formdata.customerArea,channelTypeId:a.formdata.channelTypeId,behavior:a.formdata.behavior,excludeCustomerStatus:t};this.$Post(\"api/crm/sale/rule/create\",r,function(e){a.open_create_rule=!1,a.$bus.emit(\"update_customer_rule\",!0),a.formdata.customerLevel=\"\",a.formdata.followRanks=\"\",a.formdata.followRanks=\"\",a.formdata.changeTime=\"\",a.formdata.notifyTime=\"\",a.formdata.ruleMemo=\"\",a.formdata.departId=\"\",a.formdata.customerArea=\"\",a.formdata.channelTypeId=\"\",a.formdata.behavior=\"\",a.customerStatus=[]},function(e){})},getAllDepart:function(){var e=this;this.$Get(\"api/system/depart/list\",{},function(t){e.allDepart=t.data.data})},getAllDepartTree:function(){var e=this;this.$Get(\"api/system/depart/tree/list\",{},function(t){e.departTree=t.data.data;for(var a=0;a<e.departTree.length;a++)if(e.departTree[a].title=e.departTree[a].departname,e.departTree[a].level=1,e.departTree[a].children)for(var r=0;r<e.departTree[a].children.length;r++)if(e.departTree[a].children[r].title=e.departTree[a].children[r].departname,e.departTree[a].children[r].level=2,e.departTree[a].children[r].children)for(var s=0;s<e.departTree[a].children[r].children.length;s++)if(e.departTree[a].children[r].children[s].title=e.departTree[a].children[r].children[s].departname,e.departTree[a].children[r].children[s].level=3,e.departTree[a].children[r].children[s].children)for(var o=0;o<e.departTree[a].children[r].children[s].children.length;o++)e.departTree[a].children[r].children[s].children[o].title=e.departTree[a].children[r].children[s].children[o].departname,e.departTree[a].children[r].children[s].children[o].level=4})},getCheckedNodes:function(e){var t=[];if(0==e.length)t=[];else{t.push(e[0].ID);for(var a=1;a<e.length;a++)e[0].level==e[a].level&&t.push(e[a].ID)}this.check_depart_id=t.join(\",\")}},created:function(){var e=this;this.getAllDepartTree(),this.$bus.on(\"open_create_customer_rule\",function(t){e.open_create_rule=!0})}},s=(a(292),a(2)),o=Object(s.a)(r,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a(\"Modal\",{attrs:{title:\"新增销售规则\",width:\"900\",\"mask-closable\":!1},on:{\"on-cancel\":function(t){e.handleReset(\"formdata\")}},model:{value:e.open_create_rule,callback:function(t){e.open_create_rule=t},expression:\"open_create_rule\"}},[a(\"Row\",{attrs:{gutter:20}},[a(\"Col\",{attrs:{span:\"15\"}},[a(\"Form\",{ref:\"formdata\",attrs:{\"label-width\":100,rules:e.formdataRule,model:e.formdata,\"show-message\":!1}},[a(\"Row\",[a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{prop:\"customerStatus\"}},[a(\"span\",{staticClass:\"warning\",attrs:{slot:\"label\"},slot:\"label\"},[e._v(\"客户状态\")]),e._v(\" \"),a(\"Cascader\",{staticStyle:{width:\"100%\"},attrs:{size:\"small\",data:e.CUStype,trigger:\"hover\",transfer:\"\"},model:{value:e.customerStatus,callback:function(t){e.customerStatus=t},expression:\"customerStatus\"}})],1)],1),e._v(\" \"),a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{label:\"客户等级\",prop:\"customerLevel\"}},[a(\"Select\",{staticStyle:{width:\"100%\"},attrs:{transfer:\"\",size:\"small\"},model:{value:e.formdata.customerLevel,callback:function(t){e.$set(e.formdata,\"customerLevel\",t)},expression:\"formdata.customerLevel\"}},e._l(e.customerrating,function(t){return a(\"Option\",{key:t.id,attrs:{value:t.typecode}},[e._v(e._s(t.typename))])}),1)],1)],1)],1),e._v(\" \"),a(\"Row\",[a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{label:\"客户地区\",prop:\"customerArea\"}},[a(\"Select\",{staticStyle:{width:\"100%\"},attrs:{transfer:\"\",size:\"small\"},model:{value:e.formdata.customerArea,callback:function(t){e.$set(e.formdata,\"customerArea\",t)},expression:\"formdata.customerArea\"}},e._l(e.area,function(t){return a(\"Option\",{key:t.id,attrs:{value:t.typecode}},[e._v(e._s(t.typename))])}),1)],1)],1),e._v(\" \"),a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{label:\"客户渠道\",prop:\"channelTypeId\"}},[a(\"Select\",{staticStyle:{width:\"100%\"},attrs:{transfer:\"\",size:\"small\"},model:{value:e.formdata.channelTypeId,callback:function(t){e.$set(e.formdata,\"channelTypeId\",t)},expression:\"formdata.channelTypeId\"}},e._l(e.cluesources,function(t){return a(\"Option\",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.channel_type_name))])}),1)],1)],1)],1),e._v(\" \"),a(\"Row\",[a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{label:\"行为\",prop:\"behavior\"}},[a(\"Select\",{staticStyle:{width:\"100%\"},attrs:{transfer:\"\",size:\"small\"},model:{value:e.formdata.behavior,callback:function(t){e.$set(e.formdata,\"behavior\",t)},expression:\"formdata.behavior\"}},e._l(e.behavior,function(t){return a(\"Option\",{key:t.id,attrs:{value:t.typecode}},[e._v(e._s(t.typename))])}),1)],1)],1),e._v(\" \"),a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{label:\"惩罚\",prop:\"punishment\"}},[a(\"Select\",{staticStyle:{width:\"100%\"},attrs:{transfer:\"\",size:\"small\"},model:{value:e.formdata.punishment,callback:function(t){e.$set(e.formdata,\"punishment\",t)},expression:\"formdata.punishment\"}},e._l(e.fpunishment,function(t){return a(\"Option\",{key:t.id,attrs:{value:t.typecode}},[e._v(e._s(t.typename))])}),1)],1)],1)],1),e._v(\" \"),a(\"Row\",[a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{label:\"跟进评分\",prop:\"followRanks\"}},[a(\"Select\",{staticStyle:{width:\"100%\"},attrs:{transfer:\"\",size:\"small\"},model:{value:e.formdata.followRanks,callback:function(t){e.$set(e.formdata,\"followRanks\",t)},expression:\"formdata.followRanks\"}},e._l(e.rating,function(t){return a(\"Option\",{key:t.id,attrs:{value:t.typecode}},[e._v(e._s(t.typename))])}),1)],1)],1)],1),e._v(\" \"),a(\"Row\",[a(\"Col\",[a(\"FormItem\",{attrs:{label:\"划入期限\",prop:\"changeTime\"}},[a(\"Input\",{staticStyle:{width:\"80px\",\"margin-right\":\"5px\"},attrs:{size:\"small\"},model:{value:e.formdata.changeTime,callback:function(t){e.$set(e.formdata,\"changeTime\",t)},expression:\"formdata.changeTime\"}}),e._v(\" \"),a(\"span\",[e._v(\"天（有效天数，非工作日）\")])],1)],1)],1),e._v(\" \"),a(\"Row\",[a(\"Col\",[a(\"FormItem\",{attrs:{label:\"提前通知时间\",prop:\"notifyTime\"}},[a(\"Input\",{staticStyle:{width:\"80px\",\"margin-right\":\"5px\"},attrs:{size:\"small\"},model:{value:e.formdata.notifyTime,callback:function(t){e.$set(e.formdata,\"notifyTime\",t)},expression:\"formdata.notifyTime\"}}),e._v(\" \"),a(\"span\",[e._v(\"天（有效天数，非工作日）\")])],1)],1),e._v(\" \"),a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{prop:\"exclude_customer_status\"}},[a(\"span\",{staticClass:\"warning\",attrs:{slot:\"label\"},slot:\"label\"},[e._v(\"排除客户状态\")]),e._v(\" \"),a(\"Cascader\",{staticStyle:{width:\"100%\"},attrs:{size:\"small\",data:e.CUStype,trigger:\"hover\",transfer:\"\"},model:{value:e.exclude_customer_status,callback:function(t){e.exclude_customer_status=t},expression:\"exclude_customer_status\"}})],1)],1)],1)],1)],1),e._v(\" \"),a(\"Col\",{attrs:{span:\"9\"}},[a(\"Row\",{attrs:{gutter:5}},[a(\"div\",{staticStyle:{\"padding-bottom\":\"5px\"}},[e._v(\"说明：\")]),e._v(\" \"),a(\"Input\",{attrs:{type:\"textarea\",rows:6},model:{value:e.formdata.ruleMemo,callback:function(t){e.$set(e.formdata,\"ruleMemo\",t)},expression:\"formdata.ruleMemo\"}})],1),e._v(\" \"),a(\"Row\",{attrs:{gutter:5}},[a(\"div\",{staticClass:\"warning\",staticStyle:{\"padding-bottom\":\"1px\",\"padding-top\":\"5px\"}},[e._v(\"部门：\")]),e._v(\" \"),a(\"Tree\",{attrs:{data:e.departTree,\"show-checkbox\":\"\"},on:{\"on-check-change\":e.getCheckedNodes}})],1)],1)],1),e._v(\" \"),a(\"div\",{attrs:{slot:\"footer\"},slot:\"footer\"},[a(\"Button\",{staticStyle:{\"margin-bottom\":\"10px\"},attrs:{type:\"primary\"},on:{click:e.submit}},[e._v(\"新增\")])],1)],1)},[],!1,null,\"e70f1afc\",null);o.options.__file=\"create_rule.vue\";var n=o.exports,i={props:{CUStype:Array,cluesources:Array,area:Array,behavior:Array,fpunishment:Array,productType:Array,customerrating:Array},data:function(){return{check_depart_id:\"\",departTree:[],selectDepart:\"\",allDepart:[],customerStatus:[],exclude_customer_status:[],rating:[{id:1,typename:1,typecode:\"1\"},{id:2,typename:2,typecode:\"2\"},{id:3,typename:3,typecode:\"3\"},{id:4,typename:4,typecode:\"4\"},{id:5,typename:5,typecode:\"5\"}],customerTypes:[],edit_create_rule:!1,formdata:{id:\"\",customerLevel:\"\",customerArea:\"\",channelTypeId:\"\",behavior:\"\",punishment:\"\",followRanks:\"\",changeTime:\"\",notifyTime:\"\",ruleMemo:\"\"},formdataRule:{customerLevel:{required:!0,message:\"客户等级必选！\",trigger:\"change\"},behavior:{required:!0,message:\"行为必选！\",trigger:\"change\"},followRanks:{required:!0,message:\"跟进评分必选！\",trigger:\"change\"},punishment:{required:!0,message:\"惩罚必选！\",trigger:\"change\"},changeTime:{required:!0,message:\"划入期限必填！\",trigger:\"blur\"},notifyTime:{required:!0,message:\"提前通知时间必填！\",trigger:\"blur\"}}}},methods:{handleReset:function(e){this.$refs[e].resetFields(),this.customerStatus=[],this.check_depart_id=\"\",this.getAllDepartTree()},submit:function(){var e=this,t=this;this.$refs.formdata.validate(function(a){a&&\"\"!=t.check_depart_id?t.create_rule():e.$Message.error(\"请补全信息！\")})},create_rule:function(){var e=this,t=\"\";t=\"\"!=e.customerStatus?e.customerStatus[0]+\"-\"+e.customerStatus[1]:\"\";var a=\"\";a=\"\"!=e.exclude_customer_status?e.exclude_customer_status[0]+\"-\"+e.exclude_customer_status[1]:\"\";var r={id:e.formdata.id,customerStatus:t,customerLevel:e.formdata.customerLevel,followRanks:e.formdata.followRanks,punishment:e.formdata.punishment,changeTime:e.formdata.changeTime,notifyTime:e.formdata.notifyTime,departId:e.check_depart_id,ruleMemo:e.formdata.ruleMemo,customerArea:e.formdata.customerArea,channelTypeId:e.formdata.channelTypeId,behavior:e.formdata.behavior,excludeCustomerStatus:a};this.$Post(\"api/crm/sale/rule/update\",r,function(t){e.open_create_rule=!1,e.$bus.emit(\"update_customer_rule\",!0),e.formdata.customerLevel=\"\",e.formdata.followRanks=\"\",e.formdata.changeTime=\"\",e.formdata.notifyTime=\"\",e.formdata.ruleMemo=\"\",e.check_depart_id=\"\",e.formdata.customerArea=\"\",e.formdata.channelTypeId=\"\",e.formdata.behavior=\"\",e.customerStatus=[],e.exclude_customer_status=[],e.edit_create_rule=!1},function(e){})},getAllDepart:function(){var e=this;this.$Get(\"api/system/depart/list\",{},function(t){e.allDepart=t.data.data})},getAllDepartTree:function(){var e=this;this.$Get(\"api/system/depart/tree/list\",{},function(t){e.departTree=t.data.data;for(var a=0;a<e.departTree.length;a++)if(e.departTree[a].title=e.departTree[a].departname,e.departTree[a].ID==e.check_depart_id&&(e.departTree[a].checked=!0),e.departTree[a].children)for(var r=0;r<e.departTree[a].children.length;r++)if(e.departTree[a].children[r].ID==e.check_depart_id&&(e.departTree[a].children[r].checked=!0),e.departTree[a].children[r].title=e.departTree[a].children[r].departname,e.departTree[a].children[r].children)for(var s=0;s<e.departTree[a].children[r].children.length;s++)if(e.departTree[a].children[r].children[s].ID==e.check_depart_id&&(e.departTree[a].children[r].children[s].checked=!0),e.departTree[a].children[r].children[s].title=e.departTree[a].children[r].children[s].departname,e.departTree[a].children[r].children[s].children)for(var o=0;o<e.departTree[a].children[r].children[s].children.length;o++)e.departTree[a].children[r].children[s].children[o].ID&&(e.departTree[a].children[r].children[s].children[o].checked=!0),e.departTree[a].children[r].children[s].children[o].title=e.departTree[a].children[r].children[s].children[o].departname})},getCheckedNodes:function(e){0==e.length?this.check_depart_id=\"\":this.check_depart_id=e[0].ID}},created:function(){var e=this,t=this;this.$bus.on(\"open_edit_customer_rule\",function(a){if(t.formdata.customerLevel=a.customer_level.toString(),t.formdata.customerArea=a.customer_area,a.follow_ranks&&(t.formdata.followRanks=a.follow_ranks.toString()),a.change_time&&(t.formdata.changeTime=a.change_time.toString()),a.notify_time&&(t.formdata.notifyTime=a.notify_time.toString()),t.check_depart_id=a.depart_id,t.formdata.id=a.id,t.formdata.channelTypeId=a.channel_type_id,t.formdata.behavior=a.behavior,t.formdata.punishment=a.punishment,t.formdata.ruleMemo=a.rule_memo,a.customer_status){var r=parseInt(a.customer_status.split(\"-\")[0]),s=parseInt(a.customer_status.split(\"-\")[1]);t.customerStatus.push(r),t.customerStatus.push(s)}if(a.exclude_customer_status){var o=parseInt(a.exclude_customer_status.split(\"-\")[0]),n=parseInt(a.exclude_customer_status.split(\"-\")[1]);t.exclude_customer_status.push(o),t.exclude_customer_status.push(n)}t.edit_create_rule=!0,e.getAllDepartTree()})}},l=(a(294),Object(s.a)(i,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a(\"Modal\",{attrs:{title:\"修改销售规则\",width:\"900\",\"mask-closable\":!1},on:{\"on-cancel\":function(t){e.handleReset(\"formdata\")}},model:{value:e.edit_create_rule,callback:function(t){e.edit_create_rule=t},expression:\"edit_create_rule\"}},[a(\"Row\",{attrs:{gutter:20}},[a(\"Col\",{attrs:{span:\"15\"}},[a(\"Form\",{ref:\"formdata\",attrs:{\"label-width\":100,rules:e.formdataRule,model:e.formdata,\"show-message\":!1}},[a(\"Row\",[a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{prop:\"customerStatus\"}},[a(\"span\",{staticClass:\"warning\",attrs:{slot:\"label\"},slot:\"label\"},[e._v(\"客户状态\")]),e._v(\" \"),a(\"Cascader\",{staticStyle:{width:\"100%\"},attrs:{size:\"small\",data:e.CUStype,trigger:\"hover\",transfer:\"\"},model:{value:e.customerStatus,callback:function(t){e.customerStatus=t},expression:\"customerStatus\"}})],1)],1),e._v(\" \"),a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{label:\"客户等级\",prop:\"customerLevel\"}},[a(\"Select\",{staticStyle:{width:\"100%\"},attrs:{transfer:\"\",size:\"small\"},model:{value:e.formdata.customerLevel,callback:function(t){e.$set(e.formdata,\"customerLevel\",t)},expression:\"formdata.customerLevel\"}},e._l(e.customerrating,function(t){return a(\"Option\",{key:t.id,attrs:{value:t.typecode}},[e._v(e._s(t.typename))])}),1)],1)],1)],1),e._v(\" \"),a(\"Row\",[a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{label:\"客户地区\",prop:\"customerArea\"}},[a(\"Select\",{staticStyle:{width:\"100%\"},attrs:{transfer:\"\",size:\"small\"},model:{value:e.formdata.customerArea,callback:function(t){e.$set(e.formdata,\"customerArea\",t)},expression:\"formdata.customerArea\"}},e._l(e.area,function(t){return a(\"Option\",{key:t.id,attrs:{value:t.typecode}},[e._v(e._s(t.typename))])}),1)],1)],1),e._v(\" \"),a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{label:\"客户渠道\",prop:\"channelTypeId\"}},[a(\"Select\",{staticStyle:{width:\"100%\"},attrs:{transfer:\"\",size:\"small\"},model:{value:e.formdata.channelTypeId,callback:function(t){e.$set(e.formdata,\"channelTypeId\",t)},expression:\"formdata.channelTypeId\"}},e._l(e.cluesources,function(t){return a(\"Option\",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.channel_type_name))])}),1)],1)],1)],1),e._v(\" \"),a(\"Row\",[a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{label:\"行为\",prop:\"behavior\"}},[a(\"Select\",{staticStyle:{width:\"100%\"},attrs:{transfer:\"\",size:\"small\"},model:{value:e.formdata.behavior,callback:function(t){e.$set(e.formdata,\"behavior\",t)},expression:\"formdata.behavior\"}},e._l(e.behavior,function(t){return a(\"Option\",{key:t.id,attrs:{value:t.typecode}},[e._v(e._s(t.typename))])}),1)],1)],1),e._v(\" \"),a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{label:\"惩罚\",prop:\"punishment\"}},[a(\"Select\",{staticStyle:{width:\"100%\"},attrs:{transfer:\"\",size:\"small\"},model:{value:e.formdata.punishment,callback:function(t){e.$set(e.formdata,\"punishment\",t)},expression:\"formdata.punishment\"}},e._l(e.fpunishment,function(t){return a(\"Option\",{key:t.id,attrs:{value:t.typecode}},[e._v(e._s(t.typename))])}),1)],1)],1)],1),e._v(\" \"),a(\"Row\",[a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{label:\"跟进评分\",prop:\"followRanks\"}},[a(\"Select\",{staticStyle:{width:\"100%\"},attrs:{transfer:\"\",size:\"small\"},model:{value:e.formdata.followRanks,callback:function(t){e.$set(e.formdata,\"followRanks\",t)},expression:\"formdata.followRanks\"}},e._l(e.rating,function(t){return a(\"Option\",{key:t.id,attrs:{value:t.typecode}},[e._v(e._s(t.typename))])}),1)],1)],1)],1),e._v(\" \"),a(\"Row\",[a(\"Col\",[a(\"FormItem\",{attrs:{label:\"划入期限\",prop:\"changeTime\"}},[a(\"Input\",{staticStyle:{width:\"80px\",\"margin-right\":\"5px\"},attrs:{size:\"small\"},model:{value:e.formdata.changeTime,callback:function(t){e.$set(e.formdata,\"changeTime\",t)},expression:\"formdata.changeTime\"}}),e._v(\" \"),a(\"span\",[e._v(\"天（有效天数，非工作日）\")])],1)],1)],1),e._v(\" \"),a(\"Row\",[a(\"Col\",[a(\"FormItem\",{attrs:{label:\"提前通知时间\",prop:\"notifyTime\"}},[a(\"Input\",{staticStyle:{width:\"80px\",\"margin-right\":\"5px\"},attrs:{size:\"small\"},model:{value:e.formdata.notifyTime,callback:function(t){e.$set(e.formdata,\"notifyTime\",t)},expression:\"formdata.notifyTime\"}}),e._v(\" \"),a(\"span\",[e._v(\"天（有效天数，非工作日）\")])],1)],1),e._v(\" \"),a(\"Col\",{attrs:{span:\"12\"}},[a(\"FormItem\",{attrs:{prop:\"exclude_customer_status\"}},[a(\"span\",{staticClass:\"warning\",attrs:{slot:\"label\"},slot:\"label\"},[e._v(\"排除客户状态\")]),e._v(\" \"),a(\"Cascader\",{staticStyle:{width:\"100%\"},attrs:{size:\"small\",data:e.CUStype,trigger:\"hover\",transfer:\"\"},model:{value:e.exclude_customer_status,callback:function(t){e.exclude_customer_status=t},expression:\"exclude_customer_status\"}})],1)],1)],1)],1)],1),e._v(\" \"),a(\"Col\",{attrs:{span:\"9\"}},[a(\"Row\",{attrs:{gutter:5}},[a(\"div\",{staticStyle:{\"padding-bottom\":\"5px\"}},[e._v(\"说明：\")]),e._v(\" \"),a(\"Input\",{attrs:{type:\"textarea\",rows:6},model:{value:e.formdata.ruleMemo,callback:function(t){e.$set(e.formdata,\"ruleMemo\",t)},expression:\"formdata.ruleMemo\"}})],1),e._v(\" \"),a(\"Row\",{attrs:{gutter:5}},[a(\"div\",{staticClass:\"warning\",staticStyle:{\"padding-bottom\":\"1px\",\"padding-top\":\"5px\"}},[e._v(\"部门：\")]),e._v(\" \"),a(\"Tree\",{attrs:{data:e.departTree,\"show-checkbox\":\"\"},on:{\"on-check-change\":e.getCheckedNodes}})],1)],1)],1),e._v(\" \"),a(\"div\",{attrs:{slot:\"footer\"},slot:\"footer\"},[a(\"Button\",{staticStyle:{\"margin-bottom\":\"10px\"},attrs:{type:\"primary\"},on:{click:e.submit}},[e._v(\"修改\")])],1)],1)},[],!1,null,\"680d7d1a\",null));l.options.__file=\"update_rule.vue\";var c={name:\"market_rule_index\",components:{createRule:n,updateRule:l.exports},data:function(){var e=this;return{columns:[{title:\"部门\",key:\"departname\",width:120},{title:\"客户状态\",key:\"customer_status_name\",width:150},{title:\"排除客户状态\",key:\"exculde_customer_status_name\",width:150},{title:\"客户级别\",key:\"customer_level_name\",width:120},{title:\"客户区域\",key:\"customer_area_name\",width:120},{title:\"客户渠道\",key:\"channel_type_name\",width:120},{title:\"行为\",key:\"behavior_name\",width:120},{title:\"跟进评分\",key:\"follow_ranks\",width:120},{title:\"通知期限\",key:\"notify_time\",width:120},{title:\"更改期限\",key:\"change_time\",width:120},{title:\"惩罚\",key:\"punishment_name\",width:120},{title:\"规则备注\",key:\"rule_memo\",width:180,render:function(e,t){return t.row.rule_memo.length<10?e(\"div\",t.row.rule_memo):e(\"Poptip\",{props:{trigger:\"hover\",title:\"详情\",placement:\"bottom\"}},[e(\"span\",t.row.rule_memo.slice(0,10)+\"...\"),e(\"div\",{slot:\"content\"},[e(\"span\",t.row.rule_memo)])])}},{title:\"规则状态\",key:\"taskstate\",width:120},{title:\"操作\",key:\"action\",fixed:\"right\",width:200,align:\"center\",render:function(t,a){return\"PAUSED\"==a.row.taskstate||null==a.row.taskstate?t(\"div\",[t(\"Button\",{props:{type:\"text\",size:\"small\"},on:{click:function(){e.$bus.emit(\"open_edit_customer_rule\",a.row)}}},\"[修改]\"),t(\"Button\",{props:{type:\"text\",size:\"small\"},on:{click:function(){e.start(a.row.task_id)}}},\"[执行]\")]):t(\"div\",[t(\"Button\",{props:{type:\"text\",size:\"small\"},on:{click:function(){e.$bus.emit(\"open_edit_customer_rule\",a.row)}}},\"[修改]\"),t(\"Button\",{props:{type:\"text\",size:\"small\"},on:{click:function(){e.stop(a.row.task_id)}}},\"[停止]\")])}}],data:[],rule_loading:!1,pageTotal:new Number,page:1,customerTypes:[],customerrating:[],cluesources:[],area:[],behavior:[],fpunishment:[],productType:[],customerrating_Map:new Map,cluesources_Map:new Map,area_Map:new Map,fpunishment_Map:new Map,behavior_Map:new Map,productType_Map:new Map,customerTypes_Array:[]}},methods:{start:function(e){var t=this,a={jobId:e};this.$Post(\"api/system/task/job/begin\",a,function(e){t.getData()},function(e){})},stop:function(e){var t=this,a={jobId:e};this.$Post(\"api/system/task/job/pause\",a,function(e){t.getData()},function(e){})},getData:function(){var e=this;e.rule_loading=!0;var t={params:{page:e.page,pageSize:10}};this.$Get(\"api/crm/sale/rule/list\",t,function(t){e.pageTotal=t.data.data.total,e.data=t.data.data.rows,e.rule_loading=!1;for(var a=0;a<e.data.length;a++)e.data[a].customer_area_name=e.area_Map.get(e.data[a].customer_area),e.data[a].behavior_name=e.behavior_Map.get(e.data[a].behavior),\"\"!=e.data[a].customer_status&&(e.data[a].customer_status_name=e.getLocalType(e.data[a].customer_status)),e.data[a].exclude_customer_status&&(e.data[a].exculde_customer_status_name=e.getLocalType(e.data[a].exclude_customer_status)),null!=e.data[a].customer_level&&(e.data[a].customer_level_name=e.customerrating_Map.get(e.data[a].customer_level.toString())),e.data[a].behavior_name=e.behavior_Map.get(e.data[a].behavior),e.data[a].punishment_name=e.fpunishment_Map.get(e.data[a].punishment)})},pageChange:function(e){this.page=e,this.getData()},getCustomerType:function(){var e=this;this.$GetDataCenter(\"customerTypes\",function(t){e.customerTypes=e.$changeCars(t.data.data.customerTypes),e.customerTypes_Array=e.$Data2Casr(t.data.data.customerTypes),e.customerTypes.push({label:\"空\"})})},getLocalType:function(e){for(var t=e.split(\"-\")[0],a=e.split(\"-\")[1],r=0;r<this.customerTypes_Array.length;r++)if(a==this.customerTypes_Array[r].id)return this.customerTypes_Array[r].ptypename+\" - \"+this.customerTypes_Array[r].typename;if(\"\"==a)for(var s=0;s<this.customerTypes_Array.length;s++)if(t==this.customerTypes_Array[s].pid)return this.customerTypes_Array[s].ptypename+\"- 无\"},getDataCenter:function(){var e=this;this.$GetDataCenter(\"customerrating,cluesources,area,behavior,fpunishment,productType\",function(t){e.customerrating=t.data.data.customerrating,e.area=t.data.data.area,e.area.push({typename:\"空\"}),e.behavior=t.data.data.behavior,e.fpunishment=t.data.data.fpunishment,e.productType=t.data.data.productType,e.customerrating_Map=e.$array2map(e.customerrating),e.area_Map=e.$array2map(e.area),e.behavior_Map=e.$array2map(e.behavior),e.fpunishment_Map=e.$array2map(e.fpunishment),e.productType_Map=e.$array2map(e.productType)})},getChannelList:function(){var e=this;this.$Get(\"api/channel/type/list\",{params:{page:1,pageSize:1e3}},function(t){e.cluesources=t.data.data.rows,e.cluesources.push({channel_type_name:\"空\"})})},open_create_pool_rule:function(){this.$bus.emit(\"open_create_customer_rule\",!0)}},created:function(){this.getChannelList(),this.getDataCenter(),this.getCustomerType(),this.getData();var e=this;this.$bus.on(\"update_customer_rule\",function(t){e.getData()})}},u=Object(s.a)(c,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a(\"div\",[a(\"Card\",[a(\"div\",{attrs:{slot:\"title\"},slot:\"title\"},[e._v(\"规则说明\")]),e._v(\" \"),a(\"div\",[a(\"Row\",[e._v(\"\\n                1、如果启用了【超过N天“未成交”的客户，由系统定时划入公海】，即便在N天内跟进了，只要客户的客户状态不是“成交客户”，仍然会被划入公海。\\n            \")]),e._v(\" \"),a(\"Row\",[e._v(\"2、超级管理员负责的客户，不会自动划入客户公海。\")]),e._v(\" \"),a(\"Row\",[e._v(\"3、渠道客户的惩罚默认为由有效成交线索转成有效线索\")]),e._v(\" \"),a(\"Row\",[e._v(\"4、市场部客户的惩罚默认为转入公海池\")]),e._v(\" \"),a(\"Row\",[e._v(\"5、划入期限为0时，惩罚实时生效；划入时间为N时，惩罚不生效\")]),e._v(\" \"),a(\"Row\",[e._v(\"6、客户状态、客户等级。行为、跟进评分不能都选择“全部”或者“无”\")])],1)]),e._v(\" \"),a(\"Card\",[a(\"ButtonGroup\",[a(\"Button\",{staticStyle:{\"margin-bottom\":\"10px\"},attrs:{type:\"primary\"},on:{click:e.open_create_pool_rule}},[e._v(\"新增规则\")])],1),e._v(\" \"),a(\"Table\",{attrs:{\"highlight-row\":\"\",size:\"small\",columns:e.columns,data:e.data,loading:e.rule_loading}}),e._v(\" \"),a(\"Page\",{staticStyle:{\"margin-top\":\"10px\"},attrs:{size:\"small\",total:e.pageTotal,current:e.page,\"show-total\":\"\",\"show-elevator\":\"\"},on:{\"update:current\":function(t){e.page=t},\"on-change\":e.pageChange}})],1),e._v(\" \"),a(\"create-rule\",{attrs:{CUStype:e.customerTypes,cluesources:e.cluesources,area:e.area,behavior:e.behavior,fpunishment:e.fpunishment,productType:e.productType,customerrating:e.customerrating}}),e._v(\" \"),a(\"update-rule\",{attrs:{CUStype:e.customerTypes,cluesources:e.cluesources,area:e.area,behavior:e.behavior,fpunishment:e.fpunishment,productType:e.productType,customerrating:e.customerrating}})],1)},[],!1,null,null,null);u.options.__file=\"index.vue\";t.default=u.exports}}]);"}